name: Simple Test

on:
  push:
    branches: [ main, feature/adding_qt ]
  workflow_dispatch:

jobs:
  test:
    # SECURITY: Only run on your repository
    if: github.repository == 'SEAME-pt/Car_control_Raspberry'
    
    runs-on: [self-hosted, Linux, X64, CI_CD]
    
    # Require Qt_test environment for additional security
    environment: CI_CD
    
    # Minimal permissions
    permissions:
      contents: read
    
    steps:
    - name: Clone repo to /tmp
      run: |
        cd /tmp
        rm -rf Car_control_Raspberry
        git clone https://github.com/SEAME-pt/Car_control_Raspberry.git
        ls -la Car_control_Raspberry/
        echo "Repository cloned successfully to /tmp/Car_control_Raspberry"
    - name: Compile
      run: |
        cd /tmp/Car_control_Raspberry/Qt
        source /opt/agl-sdk/20.90.0-aarch64/environment-setup-aarch64-agl-linux
        mkdir build
        cd build
        cmake ..
        make
